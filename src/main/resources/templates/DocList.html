<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/DocList.css">
  <title>기록 목록</title>
</head>
<body>
<div class="container">
  <div class="text-right mb-4">
    <p th:text="${records[0].writer}">sd</p>
    <a href="/logout">logout</a>
  </div>
  <h2 class="text-center mb-4">기록 목록</h2>
  <div id="recordAccordion" th:each="record : ${records}">
    <!-- 기록 목록이 여기에 동적으로 추가될 것입니다. -->
    <div class="card">
      <div class="card-header" th:id="'heading' + ${record.docId}">
        <h5 class="mb-0">
          <!-- 예시 URL 템플릿 -->
          <a th:href="@{/docs/{id}(id=${record.docId})}" class="btn btn-link text" th:text="${record.header}"></a>


          <button class="btn btn-link toggle-btn" data-toggle="collapse" th:data-target="'#collapse' + ${record.docId}"
                  aria-expanded="false" th:aria-controls="'collapse' + ${record.docId}">
            <span class="toggle-btn">&#8595;</span>
          </button>
        </h5>
      </div>

<!--      <div th:id="'collapse' + ${record.docId}" class="collapse" th:class="${record.subRecords ? 'show' : ''}">-->
        <div class="card-body">
          <ul>
<!--            <li th:each="subRecord : ${record.subRecords}" th:text="${subRecord.header}"></li>-->
          </ul>
        </div>
      </div>
    </div>
  <button class="btn btn-primary mt-4" id="addRecordBtn" onclick="location.href='/docs/add'">기록물 추가</button>

  </div>

  <!-- 기록물 추가 버튼 -->
</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<script>
  var recordAccordion = document.getElementById('recordAccordion');

  function renderRecords(records, container) {
    container.innerHTML = ''; // 기존 내용 비우기
    records.forEach(function(record, index) {
      var card = document.createElement('div');
      card.className = 'card';

      var cardHeader = document.createElement('div');
      cardHeader.className = 'card-header';
      cardHeader.id = 'heading' + index;
      cardHeader.innerHTML = `
                    <h5 class="mb-0">
                        <a href="DocDetail.html?index=${index}" class="btn btn-link">
                            ${record.title}
                        </a>
                        <button class="btn btn-link toggle-btn" data-toggle="collapse" data-target="#collapse${index}" aria-expanded="false" aria-controls="collapse${index}">
                            <span class="toggle-btn">&#8595;</span>
                        </button>
                    </h5>
                `;
      card.appendChild(cardHeader);

      var collapseDiv = document.createElement('div');
      collapseDiv.id = 'collapse' + index;
      collapseDiv.className = 'collapse';
      collapseDiv.innerHTML = `
                    <div class="card-body">
                        ${record.subRecords ? renderSubRecords(record.subRecords) : ''}
                    </div>
                `;
      card.appendChild(collapseDiv);

      container.appendChild(card);
    });
  }

  function renderSubRecords(subRecords) {
    var subRecordsHtml = '<ul>';
    subRecords.forEach(function(subRecord) {
      subRecordsHtml += `<li>${subRecord.title}</li>`;
    });
    subRecordsHtml += '</ul>';
    return subRecordsHtml;
  }

  // 초기 렌더링
  renderRecords(records, recordAccordion);

  // Toggle 버튼 클릭 이벤트
  recordAccordion.addEventListener('click', function(e) {
    if (e.target.classList.contains('toggle-btn')) {
      var arrowBtn = e.target;
      toggleArrow(arrowBtn);
    }
  });
  // 초기 렌더링 시에 'Toggle Sub Records' 버튼의 화살표를 '✖'로 설정
  document.querySelectorAll('.toggle-btn').forEach(function (arrowBtn) {
    arrowBtn.innerHTML = '↓';
  });

  function toggleArrow(arrowBtn) {
    var arrow = arrowBtn.innerHTML;
    arrowBtn.innerHTML = arrow === '✖' ? '↓' : '✖';
  }
</script>
</body>
</html>
